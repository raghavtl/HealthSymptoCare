import React, { useState, useEffect, useRef } from 'react';

const DeStressZone = () => {
  const [activeTab, setActiveTab] = useState('breathing');
  const [timerRunning, setTimerRunning] = useState(false);
  const [timerSeconds, setTimerSeconds] = useState(0);
  const [breathingPhase, setBreathingPhase] = useState('inhale');
  const [breathingCount, setBreathingCount] = useState(4);
  const [quote, setQuote] = useState({});
  const [currentAudio, setCurrentAudio] = useState(null);
  const [isPlaying, setIsPlaying] = useState(false);
  const [selectedVoice, setSelectedVoice] = useState('male');
  const [feelingRating, setFeelingRating] = useState(5);
  const [soundLevels, setSoundLevels] = useState({
    rain: 50,
    flute: 30,
    wind: 20,
    ocean: 60
  });
  const [affirmations, setAffirmations] = useState([
    'I am calm and centered',
    'I release all tension and stress',
    'I am at peace with myself'
  ]);
  const audioRef = useRef(null);
  const audioMixerRefs = useRef({
    rain: null,
    flute: null,
    wind: null,
    ocean: null
  });
  
  // Timer effect
  useEffect(() => {
    let interval = null;
    
    if (timerRunning) {
      interval = setInterval(() => {
        setTimerSeconds(seconds => seconds + 1);
      }, 1000);
    } else if (!timerRunning && timerSeconds !== 0) {
      clearInterval(interval);
    }
    
    return () => clearInterval(interval);
  }, [timerRunning, timerSeconds]);
  
  // Breathing exercise effect
  useEffect(() => {
    let breathingInterval = null;
    
    if (activeTab === 'breathing' && timerRunning) {
      breathingInterval = setInterval(() => {
        setBreathingPhase(phase => {
          if (phase === 'inhale') return 'hold';
          if (phase === 'hold') return 'exhale';
          return 'inhale';
        });
      }, breathingCount * 1000);
    }
    
    return () => clearInterval(breathingInterval);
  }, [activeTab, timerRunning, breathingCount]);
  

  
  // Function to set voice based on selection
  const setVoiceBasedOnSelection = (msg, voices) => {
    console.log('Setting voice based on selection:', selectedVoice);
    console.log('Available voices:', voices.map(v => v.name));
    
    // Set voice based on selection
    if (selectedVoice === 'male') {
      const maleVoice = voices.find(voice => voice.name.includes('Male') || voice.name.includes('male'));
      if (maleVoice) {
        console.log('Found male voice:', maleVoice.name);
        msg.voice = maleVoice;
      } else {
        console.log('No male voice found, using default');
      }
    } else if (selectedVoice === 'female') {
      const femaleVoice = voices.find(voice => voice.name.includes('Female') || voice.name.includes('female'));
      if (femaleVoice) {
        console.log('Found female voice:', femaleVoice.name);
        msg.voice = femaleVoice;
      } else {
        console.log('No female voice found, using default');
      }
    } else if (selectedVoice === 'ai') {
      console.log('Using AI voice settings');
      msg.rate = 0.9;
      msg.pitch = 1.2;
    }
  };
  
  // Helper function to handle AI voice delay
  const handleAIVoiceDelay = () => {
    if (selectedVoice === 'ai') {
      return new Promise(resolve => setTimeout(resolve, 500));
    }
    return Promise.resolve();
  };
  
  // Load random quote on mount
  useEffect(() => {
    const quotes = [
      {
        text: "The greatest weapon against stress is our ability to choose one thought over another.",
        author: "William James"
      },
      {
        text: "It's not stress that kills us, it is our reaction to it.",
        author: "Hans Selye"
      },
      {
        text: "Breath is the power behind all things. I breathe in and know that good things will happen.",
        author: "Tao Porchon-Lynch"
      },
      {
        text: "Within you, there is a stillness and a sanctuary to which you can retreat at any time and be yourself.",
        author: "Hermann Hesse"
      },
      {
        text: "The time to relax is when you don't have time for it.",
        author: "Sydney J. Harris"
      },
      {
        text: "Your calm mind is the ultimate weapon against your challenges.",
        author: "Bryant McGill"
      },
      {
        text: "Almost everything will work again if you unplug it for a few minutes, including you.",
        author: "Anne Lamott"
      },
      {
        text: "Life should be touched, not strangled. You've got to relax, let it happen at times, and at others move forward with it.",
        author: "Ray Bradbury"
      },
      {
        text: "The greatest glory in living lies not in never falling, but in rising every time we fall.",
        author: "Nelson Mandela"
      },
      {
        text: "Peace is the result of retraining your mind to process life as it is, rather than as you think it should be.",
        author: "Wayne Dyer"
      }
    ];
    
    const randomIndex = Math.floor(Math.random() * quotes.length);
    setQuote(quotes[randomIndex]);
  }, []);
  
  const getRandomQuote = () => {
    const quotes = [
      {
        text: "The greatest weapon against stress is our ability to choose one thought over another.",
        author: "William James"
      },
      {
        text: "It's not stress that kills us, it is our reaction to it.",
        author: "Hans Selye"
      },
      {
        text: "Breath is the power behind all things. I breathe in and know that good things will happen.",
        author: "Tao Porchon-Lynch"
      },
      {
        text: "Within you, there is a stillness and a sanctuary to which you can retreat at any time and be yourself.",
        author: "Hermann Hesse"
      },
      {
        text: "The time to relax is when you don't have time for it.",
        author: "Sydney J. Harris"
      },
      {
        text: "Your calm mind is the ultimate weapon against your challenges.",
        author: "Bryant McGill"
      },
      {
        text: "Almost everything will work again if you unplug it for a few minutes, including you.",
        author: "Anne Lamott"
      },
      {
        text: "Life should be touched, not strangled. You've got to relax, let it happen at times, and at others move forward with it.",
        author: "Ray Bradbury"
      },
      {
        text: "The greatest glory in living lies not in never falling, but in rising every time we fall.",
        author: "Nelson Mandela"
      },
      {
        text: "Peace is the result of retraining your mind to process life as it is, rather than as you think it should be.",
        author: "Wayne Dyer"
      }
    ];
    
    const randomIndex = Math.floor(Math.random() * quotes.length);
    setQuote(quotes[randomIndex]);
  };
  const formatTime = (totalSeconds) => {
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  };
  
  const toggleTimer = () => {
    setTimerRunning(!timerRunning);
  };
  
  const resetTimer = () => {
    setTimerRunning(false);
    setTimerSeconds(0);
    setBreathingPhase('inhale');
  };
  
  const getBreathingInstructions = () => {
    switch (breathingPhase) {
      case 'inhale':
        return 'Inhale slowly through your nose...';
      case 'hold':
        return 'Hold your breath...';
      case 'exhale':
        return 'Exhale slowly through your mouth...';
      default:
        return 'Breathe naturally...';
    }
  };
  
  const getBreathingCircleClass = () => {
    if (!timerRunning) return 'w-40 h-40 bg-blue-100 shadow-inner animate-pulse';
    
    switch (breathingPhase) {
      case 'inhale':
        return 'w-40 h-40 animate-expand bg-blue-200 shadow-lg';
      case 'hold':
        return 'w-64 h-64 bg-blue-300 shadow-xl';
      case 'exhale':
        return 'w-64 h-64 animate-contract bg-blue-200 shadow-lg';
      default:
        return 'w-40 h-40 bg-blue-100 shadow-inner';
    }
  };
  

  
  // Function to handle audio playback
  const handleAudioPlay = (audioType) => {
    // Stop current audio if playing
    if (audioRef.current) {
      audioRef.current.pause();
      audioRef.current.currentTime = 0;
    }
    
    // If the same audio is clicked and it's playing, stop it
    if (currentAudio === audioType && isPlaying) {
      setIsPlaying(false);
      setCurrentAudio(null);
      return;
    }
    
    // Set the new audio source
    let audioSrc = '';
    switch(audioType) {
      case 'tibetan-bowls':
        audioSrc = './audios/tibetan-singing-bowls.mp3';
        break;
      case '432hz-healing':
        audioSrc = './audios/432hz-healing-music.mp3';
        break;
      case '5-min-stress-relief':
      case '10-min-mindfulness':
      case '20-min-relaxation':
      case 'nature-sounds':
      case 'mindfulness':
      case 'stress-relief':
      case 'nature-connection':
      case 'sleep-rest':
      case 'self-compassion':
      case 'quick-calm':
      case 'healing-recovery':
      case 'kids-teens':
      case 'workplace-focus':
      case 'body-scan':
        audioSrc = './audios/ocean-waves.mp3'; // Default for all other meditation types
        break;
      case 'ocean-waves':
        audioSrc = './audios/ocean-waves.mp3';
        break;
      default:
        audioSrc = './audios/ocean-waves.mp3'; // Default fallback
    }
    
    // Create and play the new audio
    if (audioSrc) {
      try {
        console.log(`Attempting to play audio: ${audioSrc}`);
        const audio = new Audio(audioSrc);
        audio.loop = true;
        
        // Add event listener for errors
        audio.addEventListener('error', (e) => {
          console.error('Audio error:', e);
          console.error('Error code:', audio.error ? audio.error.code : 'unknown');
          console.error('Error message:', audio.error ? audio.error.message : 'unknown');
          console.error('Audio source that failed:', audioSrc);
          alert(`Unable to play audio: ${audioType}. Error: ${audio.error ? audio.error.message : 'File not found or inaccessible'}`);
          setIsPlaying(false);
          setCurrentAudio(null);
        });
        
        // Play the audio
        audio.play().then(() => {
          console.log(`Successfully playing: ${audioSrc}`);
          setIsPlaying(true);
          setCurrentAudio(audioType);
          audioRef.current = audio;
        }).catch(error => {
          console.error('Error playing audio:', error);
          console.error('Audio source that failed:', audioSrc);
          alert(`Unable to play audio: ${audioType}. Please check if the file exists and try again.`);
          setIsPlaying(false);
          setCurrentAudio(null);
        });
      } catch (error) {
        console.error('Error creating audio:', error);
        console.error('Audio source that failed:', audioSrc);
        alert(`Unable to create audio player for: ${audioType}. Please try again.`);
      }
    }
  };
  
  // Effect to clean up audio when component unmounts
  useEffect(() => {
    return () => {
      // Clean up main audio
      if (audioRef.current) {
        audioRef.current.pause();
        audioRef.current = null;
      }
      
      // Clean up all background sounds
      Object.values(audioMixerRefs.current).forEach(audio => {
        if (audio) {
          audio.pause();
          audio.currentTime = 0;
        }
      });
      
      // Cancel any speech synthesis
      if (window.speechSynthesis) {
        window.speechSynthesis.cancel();
      }
    };
  }, []);
  
  return (
    <div className="max-w-4xl mx-auto">
      <h1 className="text-3xl font-bold mb-6">De-Stress Zone</h1>
      
      <div className="card mb-6">
          <div className="flex border-b">
            <button
              className={`px-4 py-2 font-medium ${activeTab === 'breathing' ? 'text-primary border-b-2 border-primary' : 'text-gray-500 hover:text-gray-700'}`}
              onClick={() => setActiveTab('breathing')}
            >
              Breathing Exercise
            </button>
            <button
              className={`px-4 py-2 font-medium ${activeTab === 'meditation' ? 'text-primary border-b-2 border-primary' : 'text-gray-500 hover:text-gray-700'}`}
              onClick={() => setActiveTab('meditation')}
            >
              Guided Meditation
            </button>
            <button
              className={`px-4 py-2 font-medium ${activeTab === 'quotes' ? 'text-primary border-b-2 border-primary' : 'text-gray-500 hover:text-gray-700'}`}
              onClick={() => setActiveTab('quotes')}
            >
              Calming Quotes
            </button>
          </div>
          
          <div className="py-6">
            {activeTab === 'breathing' && (
              <div className="text-center bg-gradient-to-b from-blue-50 to-white p-8 rounded-2xl shadow-sm">
                <h2 className="text-2xl font-semibold mb-4 text-blue-800">4-4-4 Breathing Technique</h2>
                <p className="text-gray-600 mb-8 max-w-lg mx-auto">This simple breathing exercise can help reduce stress and anxiety. Inhale for 4 seconds, hold for 4 seconds, and exhale for 4 seconds.</p>
                
                <div className="flex justify-center mb-10">
                  <div className="relative">
                    <div className={`${getBreathingCircleClass()} rounded-full flex items-center justify-center transition-all duration-1000 ease-in-out border-4 border-white`}>
                      <span className="text-blue-800 font-medium text-lg">{timerRunning ? getBreathingInstructions() : 'Press Start'}</span>
                    </div>
                    <div className="absolute -bottom-4 left-1/2 transform -translate-x-1/2 bg-white px-4 py-1 rounded-full shadow-sm text-xs text-blue-600 font-medium">
                      {breathingPhase.toUpperCase()}
                    </div>
                  </div>
                </div>
                
                <div className="mb-8 bg-white p-4 rounded-xl shadow-sm inline-block">
                  <div className="text-4xl font-bold mb-1 text-blue-700">{formatTime(timerSeconds)}</div>
                  <div className="text-sm text-gray-500 uppercase tracking-wider">Total Time</div>
                </div>
                
                <div className="flex justify-center space-x-6 mb-8">
                  <button
                    onClick={toggleTimer}
                    className={`px-8 py-3 rounded-full font-medium ${timerRunning ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-blue-600 hover:bg-blue-700'} text-white transition-colors shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200`}
                  >
                    {timerRunning ? 'Pause' : 'Start'}
                  </button>
                  <button
                    onClick={resetTimer}
                    className="px-8 py-3 rounded-full font-medium bg-gray-200 hover:bg-gray-300 text-gray-700 transition-colors shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200"
                  >
                    Reset
                  </button>
                </div>
                
                <div className="mt-8 bg-white p-4 rounded-xl shadow-sm inline-block">
                  <h3 className="font-medium mb-3 text-blue-800">Breathing Speed</h3>
                  <div className="flex items-center justify-center space-x-4">
                    <button 
                      onClick={() => setBreathingCount(Math.max(2, breathingCount - 1))}
                      className="w-10 h-10 rounded-full bg-blue-100 hover:bg-blue-200 flex items-center justify-center text-blue-800 font-bold shadow-sm transition-all duration-200"
                      disabled={breathingCount <= 2}
                    >
                      -
                    </button>
                    <span className="w-12 text-center text-xl font-bold text-blue-700">{breathingCount}s</span>
                    <button 
                      onClick={() => setBreathingCount(Math.min(8, breathingCount + 1))}
                      className="w-10 h-10 rounded-full bg-blue-100 hover:bg-blue-200 flex items-center justify-center text-blue-800 font-bold shadow-sm transition-all duration-200"
                      disabled={breathingCount >= 8}
                    >
                      +
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {activeTab === 'meditation' && (
              <div className="meditation-page">
                {/* Header & Intro Section */}
                <div className="relative mb-8 rounded-xl overflow-hidden">
                  <div className="absolute inset-0 bg-gradient-to-r from-blue-900/70 to-purple-900/70 z-10"></div>
                  <video 
                    className="w-full h-64 object-cover" 
                    autoPlay 
                    muted 
                    loop
                  >
                    <source src="https://assets.mixkit.co/videos/preview/mixkit-waves-coming-to-the-beach-5016-large.mp4" type="video/mp4" />
                    Your browser does not support the video tag.
                  </video>
                  <div className="absolute inset-0 flex flex-col items-center justify-center z-20 text-white p-6 text-center">
                    <h2 className="text-3xl font-bold mb-2 text-shadow">Guided Meditation</h2>
                    <p className="text-xl italic mb-4 text-shadow">"Today is a new chance to find peace."</p>
                    <button 
                      className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-full backdrop-blur-sm flex items-center gap-2 transition-all duration-300"
                      onClick={() => {
                        const welcomeMessage = new SpeechSynthesisUtterance("Welcome to your guided meditation session. Take a deep breath, and let's begin your journey to inner peace.");
                        welcomeMessage.rate = 0.9;
                        window.speechSynthesis.speak(welcomeMessage);
                      }}
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 001.414 1.414m2.828-9.9a9 9 0 012.728-2.728" />
                      </svg>
                      Voice Introduction
                    </button>
                  </div>
                </div>
                
                {/* Meditation Categories */}
                <div className="mb-8">
                  <h3 className="text-xl font-semibold mb-4">Meditation Categories</h3>
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {/* Original Categories */}
                    <div 
                      className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-blue-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('mindfulness');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-blue-800">🧘‍♀️ Mindfulness</h4>
                      <p className="text-sm text-gray-600 mt-1">Present moment awareness practices</p>
                    </div>
                    
                    <div 
                      className="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-purple-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('stress-relief');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-purple-800">😌 Stress Relief</h4>
                      <p className="text-sm text-gray-600 mt-1">Calm your mind and release tension</p>
                    </div>
                    
                    <div 
                      className="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-green-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('nature-connection');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-green-800">🌿 Nature Connection</h4>
                      <p className="text-sm text-gray-600 mt-1">Connect with the natural world</p>
                    </div>
                    
                    <div 
                      className="bg-gradient-to-br from-amber-50 to-amber-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-amber-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('sleep-rest');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-amber-800">💤 Sleep & Rest</h4>
                      <p className="text-sm text-gray-600 mt-1">Prepare your mind and body for sleep</p>
                    </div>
                    
                    <div 
                      className="bg-gradient-to-br from-pink-50 to-pink-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-pink-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('self-compassion');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-pink-800">❤️ Self-Compassion</h4>
                      <p className="text-sm text-gray-600 mt-1">Cultivate kindness toward yourself</p>
                    </div>
                    
                    {/* New Categories */}
                    <div 
                      className="bg-gradient-to-br from-red-50 to-red-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-red-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('quick-calm');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-red-800">⏱️ Quick Calm</h4>
                      <p className="text-sm text-gray-600 mt-1">2-3 min sessions for busy users</p>
                    </div>
                    
                    <div 
                      className="bg-gradient-to-br from-rose-50 to-rose-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-rose-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('healing-recovery');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-rose-800">💖 Healing & Recovery</h4>
                      <p className="text-sm text-gray-600 mt-1">For post-stress events or emotional healing</p>
                    </div>
                    
                    <div 
                      className="bg-gradient-to-br from-cyan-50 to-cyan-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-cyan-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('kids-teens');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-cyan-800">🧒 Kids & Teens</h4>
                      <p className="text-sm text-gray-600 mt-1">Short, friendly mindfulness sessions</p>
                    </div>
                    
                    <div 
                      className="bg-gradient-to-br from-indigo-50 to-indigo-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-indigo-200 cursor-pointer"
                      onClick={() => {
                        setCurrentAudio('workplace-focus');
                        handleAudioPlay('ocean-waves');
                      }}
                    >
                      <h4 className="font-medium text-indigo-800">💻 Workplace Focus</h4>
                      <p className="text-sm text-gray-600 mt-1">Desk-friendly short meditations</p>
                    </div>
                  </div>
                </div>
                
                {/* Session Player */}
                <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl shadow-md mb-8">
                  <h3 className="text-xl font-semibold mb-4">Session Player</h3>
                  <div className="flex flex-col lg:flex-row gap-6">
                    <div className="lg:w-1/2">
                      <div className="bg-white p-4 rounded-lg shadow-sm mb-4">
                        <h4 className="font-medium mb-3">Current Session</h4>
                        <div className="relative h-48 bg-gradient-to-br from-blue-900 to-purple-900 rounded-lg flex items-center justify-center mb-4">
                          <div className="text-white text-center">
                            <div className="text-5xl mb-2">
                              {isPlaying ? (
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-16 w-16 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                              ) : (
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                              )}
                            </div>
                            <p className="text-lg">{currentAudio || 'Select a meditation'}</p>
                          </div>
                        </div>
                        <div className="flex justify-between items-center">
                          <button 
                            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"
                            onClick={() => {
                              // Check if a meditation is selected
                              if (!currentAudio) {
                                alert('Please select a meditation first');
                                return;
                              }
                              
                              // Play the selected meditation audio
                              handleAudioPlay(currentAudio);
                              
                              // Speak an affirmation based on selected voice
                              if (window.speechSynthesis) {
                                const randomIndex = Math.floor(Math.random() * affirmations.length);
                                const msg = new SpeechSynthesisUtterance(affirmations[randomIndex]);
                                
                                // Get available voices
                                let voices = window.speechSynthesis.getVoices();
                                if (voices.length === 0) {
                                  // If voices aren't loaded yet, wait for them
                                  window.speechSynthesis.onvoiceschanged = () => {
                                    voices = window.speechSynthesis.getVoices();
                                    setVoiceBasedOnSelection(msg, voices);
                                  };
                                } else {
                                  setVoiceBasedOnSelection(msg, voices);
                                }
                                
                                // Speak the affirmation
                                handleAIVoiceDelay().then(() => {
                                  setTimeout(() => {
                                    window.speechSynthesis.speak(msg);
                                  }, 2000); // Delay to let the meditation audio start first
                                });
                              }
                            }}
                          >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Play Session
                          </button>
                          <button 
                            className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg flex items-center gap-2"
                            onClick={() => {
                              // Stop the main audio
                              if (audioRef.current) {
                                audioRef.current.pause();
                                audioRef.current.currentTime = 0;
                                setIsPlaying(false);
                                setCurrentAudio(null);
                              }
                              
                              // Stop all background sounds
                              Object.values(audioMixerRefs.current).forEach(audio => {
                                if (audio) {
                                  audio.pause();
                                  audio.currentTime = 0;
                                }
                              });
                              
                              // Stop any speech synthesis
                              if (window.speechSynthesis) {
                                window.speechSynthesis.cancel();
                              }
                            }}
                          >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                            Stop All
                          </button>
                        </div>
                      </div>
                      
                      <div className="bg-white p-4 rounded-lg shadow-sm">
                        <h4 className="font-medium mb-3">Voice Choice</h4>
                        <div className="flex gap-2 mb-4">
                          <button 
                            className={`${selectedVoice === 'male' ? 'bg-blue-500 text-white' : 'bg-blue-100 text-blue-800'} hover:bg-blue-200 px-3 py-1 rounded-full text-sm transition-colors`}
                            onClick={() => {
                              setSelectedVoice('male');
                              if (window.speechSynthesis) {
                                const msg = new SpeechSynthesisUtterance('Male voice selected for your meditation session');
                                let voices = window.speechSynthesis.getVoices();
                                if (voices.length === 0) {
                                  // If voices aren't loaded yet, wait for them
                                  window.speechSynthesis.onvoiceschanged = () => {
                                    voices = window.speechSynthesis.getVoices();
                                    const maleVoice = voices.find(voice => voice.name.includes('Male') || voice.name.includes('male'));
                                    if (maleVoice) msg.voice = maleVoice;
                                    window.speechSynthesis.speak(msg);
                                  };
                                } else {
                                  const maleVoice = voices.find(voice => voice.name.includes('Male') || voice.name.includes('male'));
                                  if (maleVoice) msg.voice = maleVoice;
                                  window.speechSynthesis.speak(msg);
                                }
                              }
                            }}
                          >Male</button>
                          <button 
                            className={`${selectedVoice === 'female' ? 'bg-purple-500 text-white' : 'bg-purple-100 text-purple-800'} hover:bg-purple-200 px-3 py-1 rounded-full text-sm transition-colors`}
                            onClick={() => {
                              setSelectedVoice('female');
                              if (window.speechSynthesis) {
                                const msg = new SpeechSynthesisUtterance('Female voice selected for your meditation session');
                                let voices = window.speechSynthesis.getVoices();
                                if (voices.length === 0) {
                                  // If voices aren't loaded yet, wait for them
                                  window.speechSynthesis.onvoiceschanged = () => {
                                    voices = window.speechSynthesis.getVoices();
                                    const femaleVoice = voices.find(voice => voice.name.includes('Female') || voice.name.includes('female'));
                                    if (femaleVoice) msg.voice = femaleVoice;
                                    window.speechSynthesis.speak(msg);
                                  };
                                } else {
                                  const femaleVoice = voices.find(voice => voice.name.includes('Female') || voice.name.includes('female'));
                                  if (femaleVoice) msg.voice = femaleVoice;
                                  window.speechSynthesis.speak(msg);
                                }
                              }
                            }}
                          >Female</button>
                          <button 
                            className={`${selectedVoice === 'ai' ? 'bg-green-500 text-white' : 'bg-green-100 text-green-800'} hover:bg-green-200 px-3 py-1 rounded-full text-sm transition-colors`}
                            onClick={() => {
                              setSelectedVoice('ai');
                              if (window.speechSynthesis) {
                                const msg = new SpeechSynthesisUtterance('AI voice selected for your meditation session');
                                msg.rate = 0.9;
                                msg.pitch = 1.2;
                                // Small delay for AI voice to ensure proper playback
                                setTimeout(() => {
                                  window.speechSynthesis.speak(msg);
                                }, 100);
                              }
                            }}
                          >AI Voice</button>
                        </div>
                        
                        <h4 className="font-medium mb-3">End Session Reflection</h4>
                        <div className="mb-2 text-sm text-gray-600">How do you feel now?</div>
                        <input 
                          type="range" 
                          min="1" 
                          max="10" 
                          value={feelingRating}
                          onChange={(e) => setFeelingRating(parseInt(e.target.value))}
                          className="w-full" 
                        />
                        <div className="flex justify-between text-xs text-gray-500">
                          <span>Stressed</span>
                          <span>Neutral</span>
                          <span>Peaceful</span>
                        </div>
                        <div className="mt-2 text-center text-sm font-medium">
                          {feelingRating < 4 ? '😟 Still feeling stressed' : 
                           feelingRating < 7 ? '😐 Getting better' : 
                           '😊 Feeling peaceful'}
                        </div>
                      </div>
                    </div>
                    
                    <div className="lg:w-1/2">
                      <div className="bg-white p-4 rounded-lg shadow-sm mb-4">
                        <h4 className="font-medium mb-3">🎵 Background Sound Mixer</h4>
                        <div className="space-y-4">
                          <div>
                            <div className="flex justify-between mb-1">
                              <label className="text-sm text-gray-600">Rain</label>
                              <span className="text-xs text-gray-500">{soundLevels.rain}%</span>
                            </div>
                            <input 
                              type="range" 
                              min="0" 
                              max="100" 
                              value={soundLevels.rain}
                              onChange={(e) => {
                                const newValue = parseInt(e.target.value);
                                setSoundLevels({...soundLevels, rain: newValue});
                                if (audioMixerRefs.current.rain) {
                                  audioMixerRefs.current.rain.volume = newValue / 100;
                                } else if (newValue > 0) {
                                  const audio = new Audio('./ocean-waves.mp3'); // Rain sound
                                  audio.loop = true;
                                  audio.volume = newValue / 100;
                                  audio.play().catch(err => {
                                    console.error('Error playing rain sound:', err);
                                    console.error('Audio source that failed: ./ocean-waves.mp3');
                                    alert('Unable to play rain sound. Please check if the file exists.');
                                  });
                                  audioMixerRefs.current.rain = audio;
                                }
                                if (newValue === 0 && audioMixerRefs.current.rain) {
                                  audioMixerRefs.current.rain.pause();
                                }
                              }}
                              className="w-full" 
                            />
                          </div>
                          
                          <div>
                            <div className="flex justify-between mb-1">
                              <label className="text-sm text-gray-600">Flute</label>
                              <span className="text-xs text-gray-500">{soundLevels.flute}%</span>
                            </div>
                            <input 
                              type="range" 
                              min="0" 
                              max="100" 
                              value={soundLevels.flute}
                              onChange={(e) => {
                                const newValue = parseInt(e.target.value);
                                setSoundLevels({...soundLevels, flute: newValue});
                                if (audioMixerRefs.current.flute) {
                                  audioMixerRefs.current.flute.volume = newValue / 100;
                                } else if (newValue > 0) {
                                  const audio = new Audio('./audios/tibetan-singing-bowls.mp3'); // Flute sound
                                  audio.loop = true;
                                  audio.volume = newValue / 100;
                                  audio.play().catch(err => {
                                    console.error('Error playing flute sound:', err);
                                    console.error('Audio source that failed: ./audios/tibetan-singing-bowls.mp3');
                                    alert('Unable to play flute sound. Please check if the file exists.');
                                  });
                                  audioMixerRefs.current.flute = audio;
                                }
                                if (newValue === 0 && audioMixerRefs.current.flute) {
                                  audioMixerRefs.current.flute.pause();
                                }
                              }}
                              className="w-full" 
                            />
                          </div>
                          
                          <div>
                            <div className="flex justify-between mb-1">
                              <label className="text-sm text-gray-600">Wind</label>
                              <span className="text-xs text-gray-500">{soundLevels.wind}%</span>
                            </div>
                            <input 
                              type="range" 
                              min="0" 
                              max="100" 
                              value={soundLevels.wind}
                              onChange={(e) => {
                                const newValue = parseInt(e.target.value);
                                setSoundLevels({...soundLevels, wind: newValue});
                                if (audioMixerRefs.current.wind) {
                                  audioMixerRefs.current.wind.volume = newValue / 100;
                                } else if (newValue > 0) {
                                  const audio = new Audio('./ocean-waves.mp3'); // Wind sound
                                  audio.loop = true;
                                  audio.volume = newValue / 100;
                                  audio.play().catch(err => {
                                    console.error('Error playing wind sound:', err);
                                    console.error('Audio source that failed: ./ocean-waves.mp3');
                                    alert('Unable to play wind sound. Please check if the file exists.');
                                  });
                                  audioMixerRefs.current.wind = audio;
                                }
                                if (newValue === 0 && audioMixerRefs.current.wind) {
                                  audioMixerRefs.current.wind.pause();
                                }
                              }}
                              className="w-full" 
                            />
                          </div>
                          
                          <div>
                            <div className="flex justify-between mb-1">
                              <label className="text-sm text-gray-600">Ocean</label>
                              <span className="text-xs text-gray-500">{soundLevels.ocean}%</span>
                            </div>
                            <input 
                              type="range" 
                              min="0" 
                              max="100" 
                              value={soundLevels.ocean}
                              onChange={(e) => {
                                const newValue = parseInt(e.target.value);
                                setSoundLevels({...soundLevels, ocean: newValue});
                                if (audioMixerRefs.current.ocean) {
                                  audioMixerRefs.current.ocean.volume = newValue / 100;
                                } else if (newValue > 0) {
                                  const audio = new Audio('./ocean-waves.mp3');
                                  audio.loop = true;
                                  audio.volume = newValue / 100;
                                  audio.play().catch(err => {
                                    console.error('Error playing ocean sound:', err);
                                    console.error('Audio source that failed: ./ocean-waves.mp3');
                                    alert('Unable to play ocean sound. Please check if the file exists.');
                                  });
                                  audioMixerRefs.current.ocean = audio;
                                }
                                if (newValue === 0 && audioMixerRefs.current.ocean) {
                                  audioMixerRefs.current.ocean.pause();
                                }
                              }}
                              className="w-full" 
                            />
                          </div>
                        </div>
                      </div>
                      
                      <div className="bg-white p-4 rounded-lg shadow-sm">
                        <h4 className="font-medium mb-3">Custom Affirmations</h4>
                        <div className="space-y-2 mb-4">
                          <input 
                            type="text" 
                            value={affirmations[0]}
                            onChange={(e) => {
                              const newAffirmations = [...affirmations];
                              newAffirmations[0] = e.target.value;
                              setAffirmations(newAffirmations);
                            }}
                            className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                          />
                          <input 
                            type="text" 
                            value={affirmations[1]}
                            onChange={(e) => {
                              const newAffirmations = [...affirmations];
                              newAffirmations[1] = e.target.value;
                              setAffirmations(newAffirmations);
                            }}
                            className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                          />
                          <input 
                            type="text" 
                            value={affirmations[2]}
                            onChange={(e) => {
                              const newAffirmations = [...affirmations];
                              newAffirmations[2] = e.target.value;
                              setAffirmations(newAffirmations);
                            }}
                            className="w-full p-2 border border-gray-300 rounded-lg text-sm"
                          />
                        </div>
                        <button className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg w-full text-sm">
                          Save Affirmations
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* Visual Guidance */}
                <div className="mb-8">
                  <h3 className="text-xl font-semibold mb-4">Visual Guidance</h3>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="bg-white p-4 rounded-xl shadow-md text-center">
                      <h4 className="font-medium mb-3">3D Breathing Ball 🌐</h4>
                      <div className="relative flex justify-center mb-4">
                        <div className="breathing-circle w-32 h-32 bg-blue-400 rounded-full flex items-center justify-center text-white">
                          <span>Breathe</span>
                        </div>
                      </div>
                      <p className="text-sm text-gray-600">Expands/contracts for inhale/exhale guidance</p>
                    </div>
                    
                    <div className="bg-white p-4 rounded-xl shadow-md text-center">
                      <h4 className="font-medium mb-3">AR Mode (Coming Soon)</h4>
                      <div className="relative flex justify-center mb-4">
                        <div className="w-32 h-32 bg-gray-200 rounded-lg flex items-center justify-center">
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                          </svg>
                        </div>
                      </div>
                      <p className="text-sm text-gray-600">Show breathing guide in real space via camera</p>
                    </div>
                    
                    <div className="bg-white p-4 rounded-xl shadow-md text-center">
                      <h4 className="font-medium mb-3">Ambient Mode</h4>
                      <div className="relative flex justify-center mb-4">
                        <div className="w-32 h-32 bg-gradient-to-br from-blue-400 to-purple-500 rounded-lg flex items-center justify-center pulse-animation">
                          <div className="w-16 h-16 bg-white/30 rounded-full"></div>
                        </div>
                      </div>
                      <p className="text-sm text-gray-600">Dim background, glowing animation synced with breath</p>
                    </div>
                  </div>
                </div>
                
                {/* Progress & Insights */}
                <div className="bg-white p-6 rounded-xl shadow-md mb-8">
                  <h3 className="text-xl font-semibold mb-4">Progress & Insights</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <h4 className="font-medium mb-3">Wellness Dashboard</h4>
                      <div className="bg-gray-50 p-4 rounded-lg">
                        <div className="flex justify-between items-center mb-4">
                          <div>
                            <div className="text-sm text-gray-500">Total meditation this week</div>
                            <div className="text-2xl font-bold">45 minutes</div>
                          </div>
                          <div className="text-right">
                            <div className="text-sm text-gray-500">Current streak</div>
                            <div className="text-2xl font-bold text-green-600">5 days 🎉</div>
                          </div>
                        </div>
                        
                        <div className="mb-4">
                          <div className="text-sm font-medium mb-1">Mood trend</div>
                          <div className="h-24 bg-white rounded-lg p-2">
                            <div className="flex items-end h-full space-x-2">
                              <div style={{height: '30%'}} className="w-1/7 bg-blue-400 rounded-t-sm"></div>
                              <div style={{height: '45%'}} className="w-1/7 bg-blue-400 rounded-t-sm"></div>
                              <div style={{height: '40%'}} className="w-1/7 bg-blue-400 rounded-t-sm"></div>
                              <div style={{height: '60%'}} className="w-1/7 bg-blue-400 rounded-t-sm"></div>
                              <div style={{height: '75%'}} className="w-1/7 bg-blue-500 rounded-t-sm"></div>
                              <div style={{height: '85%'}} className="w-1/7 bg-blue-600 rounded-t-sm"></div>
                              <div style={{height: '90%'}} className="w-1/7 bg-blue-700 rounded-t-sm"></div>
                            </div>
                          </div>
                          <div className="flex justify-between text-xs text-gray-500">
                            <span>Mon</span>
                            <span>Tue</span>
                            <span>Wed</span>
                            <span>Thu</span>
                            <span>Fri</span>
                            <span>Sat</span>
                            <span>Sun</span>
                          </div>
                        </div>
                        
                        <div className="text-center">
                          <button className="text-blue-600 text-sm hover:underline">View detailed report</button>
                        </div>
                      </div>
                    </div>
                    
                    <div>
                      <h4 className="font-medium mb-3">AI Smart Suggestions</h4>
                      <div className="bg-blue-50 p-4 rounded-lg mb-4">
                        <div className="flex items-start gap-3">
                          <div className="bg-blue-100 p-2 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                          </div>
                          <div>
                            <h5 className="font-medium text-blue-800">Recommendation</h5>
                            <p className="text-sm text-gray-600">You've been anxious lately → try 10 min Anxiety Relief meditation</p>
                          </div>
                        </div>
                      </div>
                      
                      <div className="bg-purple-50 p-4 rounded-lg">
                        <h5 className="font-medium text-purple-800 mb-2">Weekly Mindfulness Report</h5>
                        <p className="text-sm text-gray-600 mb-3">You were calmer on days you meditated in the morning. Consider making morning meditation a habit.</p>
                        <div className="flex justify-between text-xs">
                          <span className="text-purple-600">Sleep quality improved by 22%</span>
                          <button className="text-purple-800 hover:underline">Details</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* Community & Motivation */}
                <div className="bg-gradient-to-r from-indigo-50 to-purple-50 p-6 rounded-xl shadow-md">
                  <h3 className="text-xl font-semibold mb-4">Community & Motivation</h3>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <h4 className="font-medium mb-3">🧑‍🤝‍🧑 Group Meditation</h4>
                      <p className="text-sm text-gray-600 mb-3">Join live or recorded sessions with others</p>
                      <button className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm w-full">
                        Join Next Session
                      </button>
                    </div>
                    
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <h4 className="font-medium mb-3">Share Progress</h4>
                      <p className="text-sm text-gray-600 mb-3">Share your meditation streak with friends</p>
                      <button className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm w-full">
                        Share 5-Day Streak
                      </button>
                    </div>
                    
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                      <h4 className="font-medium mb-3">Challenges</h4>
                      <p className="text-sm text-gray-600 mb-3">Join the 7-day Stress-Free Challenge</p>
                      <div className="w-full bg-gray-200 rounded-full h-2.5">
                        <div className="bg-green-600 h-2.5 rounded-full" style={{width: '40%'}}></div>
                      </div>
                      <div className="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Day 2 of 7</span>
                        <span>40% complete</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <style jsx>{`
                  .text-shadow {
                    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                  }
                  
                  .breathing-circle {
                    animation: breathe 8s infinite ease-in-out;
                  }
                  
                  @keyframes breathe {
                    0%, 100% { transform: scale(1); opacity: 0.7; }
                    50% { transform: scale(1.3); opacity: 1; }
                  }
                  
                  .pulse-animation {
                    animation: pulse 4s infinite ease-in-out;
                  }
                  
                  @keyframes pulse {
                    0%, 100% { opacity: 0.7; }
                    50% { opacity: 1; }
                  }
                `}</style>
              </div>
            )}
          
          {activeTab === 'quotes' && (
            <div className="text-center">
              <h2 className="text-xl font-semibold mb-4">Calming Quotes</h2>
              <p className="text-gray-600 mb-6">Find inspiration and peace in these thoughtful quotes.</p>
              
              <div className="max-w-lg mx-auto bg-blue-50 p-6 rounded-lg mb-6">
                <blockquote className="text-xl italic text-gray-800 mb-2">"{quote.text}"</blockquote>
                <cite className="text-gray-600">— {quote.author}</cite>
              </div>
              
              <button
                onClick={getRandomQuote}
                className="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded transition-colors"
              >
                New Quote
              </button>
            </div>
          )}
        </div>
      </div>
      
      <div className="card bg-gradient-to-r from-blue-50 to-purple-50">
        <h2 className="text-xl font-semibold mb-4">Quick Stress Relief Tips</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 className="font-medium text-primary mb-2">Physical Techniques</h3>
            <ul className="space-y-2">
              <li className="flex items-start">
                <span className="text-primary mr-2">•</span>
                <span><strong>Progressive Muscle Relaxation:</strong> Tense and then release each muscle group in your body.</span>
              </li>
              <li className="flex items-start">
                <span className="text-primary mr-2">•</span>
                <span><strong>Take a Walk:</strong> Even a short 5-minute walk can help clear your mind.</span>
              </li>
              <li className="flex items-start">
                <span className="text-primary mr-2">•</span>
                <span><strong>Stretch:</strong> Simple stretches can release tension in your body.</span>
              </li>
              <li className="flex items-start">
                <span className="text-primary mr-2">•</span>
                <span><strong>Hydrate:</strong> Drink a glass of water slowly, focusing on the sensation.</span>
              </li>
            </ul>
          </div>
          
          <div>
            <h3 className="font-medium text-primary mb-2">Mental Techniques</h3>
            <ul className="space-y-2">
              <li className="flex items-start">
                <span className="text-primary mr-2">•</span>
                <span><strong>5-4-3-2-1 Method:</strong> Name 5 things you see, 4 things you feel, 3 things you hear, 2 things you smell, and 1 thing you taste.</span>
              </li>
              <li className="flex items-start">
                <span className="text-primary mr-2">•</span>
                <span><strong>Visualization:</strong> Imagine a peaceful place in detail.</span>
              </li>
              <li className="flex items-start">
                <span className="text-primary mr-2">•</span>
                <span><strong>Gratitude:</strong> List three things you're grateful for right now.</span>
              </li>
              <li className="flex items-start">
                <span className="text-primary mr-2">•</span>
                <span><strong>Music:</strong> Listen to calming music for a few minutes.</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
      
      <style jsx>{`
        @keyframes expand {
          0% { transform: scale(1); box-shadow: 0 0 0 rgba(66, 153, 225, 0.5); }
          50% { transform: scale(1.3); box-shadow: 0 0 20px rgba(66, 153, 225, 0.6); }
          100% { transform: scale(1.6); box-shadow: 0 0 30px rgba(66, 153, 225, 0.7); }
        }
        
        @keyframes contract {
          0% { transform: scale(1.6); box-shadow: 0 0 30px rgba(66, 153, 225, 0.7); }
          50% { transform: scale(1.3); box-shadow: 0 0 20px rgba(66, 153, 225, 0.6); }
          100% { transform: scale(1); box-shadow: 0 0 0 rgba(66, 153, 225, 0.5); }
        }
        
        @keyframes pulse {
          0% { box-shadow: 0 0 0 0 rgba(66, 153, 225, 0.7); }
          70% { box-shadow: 0 0 10px 10px rgba(66, 153, 225, 0); }
          100% { box-shadow: 0 0 0 0 rgba(66, 153, 225, 0); }
        }
        
        @keyframes playing-pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); }
        }
        
        .animate-expand {
          animation: expand ${breathingCount}s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .animate-contract {
          animation: contract ${breathingCount}s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .playing-animation {
          animation: playing-pulse 2s infinite ease-in-out;
        }
      `}</style>
    </div>
  );
};

export default DeStressZone;
